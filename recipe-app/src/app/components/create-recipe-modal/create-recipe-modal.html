@if (isOpen) {
<div
  class="fixed inset-0 backdrop-blur-sm bg-black/50 z-[9999] overflow-y-auto animate-in fade-in duration-300"
  (click)="onBackdropClick($event)"
>
  <div class="min-h-full flex items-center justify-center p-4">
    <div
      class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-4xl my-8 relative transform transition-all duration-300 animate-in slide-in-from-bottom-4 zoom-in-95"
      (click)="$event.stopPropagation()"
    >
      <!-- Enhanced header with better gradient and close button styling -->
      <div class="flex justify-between items-center mb-8 pb-4 border-b border-gray-100">
        <div class="space-y-1">
          <h2 class="text-4xl font-bold bg-gradient-to-r from-orange-500 via-red-500 to-pink-500 bg-clip-text text-transparent">
            Create Your Culinary Masterpiece
          </h2>
          <p class="text-gray-600 text-sm">Share your delicious recipe with the world</p>
        </div>
        <button
          (click)="onClose()"
          class="group relative p-3 text-gray-400 hover:text-gray-600 transition-all duration-200 hover:bg-gray-50 rounded-full hover:scale-110"
        >
          <svg class="w-6 h-6 transition-transform group-hover:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          <div class="absolute inset-0 rounded-full bg-red-500/10 scale-0 group-hover:scale-100 transition-transform duration-200"></div>
        </button>
      </div>

      @if (error) {
      <!-- Enhanced error styling with animation -->
      <div class="mb-6 p-4 bg-gradient-to-r from-red-50 to-pink-50 border-l-4 border-red-500 text-red-700 rounded-lg animate-in slide-in-from-left duration-300">
        <div class="flex items-center space-x-2">
          <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          <p class="font-semibold">Oops! Something went wrong:</p>
        </div>
        <p class="mt-1 ml-7">{{ error }}</p>
      </div>
      }

      <!-- Enhanced scrollable form container with custom scrollbar -->
      <div class="max-h-[70vh] overflow-y-auto pr-2 custom-scrollbar">
        <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()" class="space-y-8">
          <!-- Enhanced Recipe Title with floating label effect -->
          <div class="group relative">
            <input
              formControlName="title"
              type="text"
              class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 placeholder-transparent bg-gray-50/50 hover:bg-white focus:bg-white"
              [class.border-red-400]="recipeForm.get('title')?.invalid && recipeForm.get('title')?.touched"
              placeholder="Recipe Title"
              id="title"
            />
            <label for="title" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-400 peer-placeholder-shown:top-4 peer-focus:-top-2.5 peer-focus:text-sm peer-focus:text-orange-600">
              Recipe Title
            </label>
            <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-orange-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
            @if (getFieldError('title')) {
            <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
              {{ getFieldError('title') }}
            </p>
            }
          </div>

          <!-- Enhanced Description with floating label -->
          <div class="group relative">
            <textarea
              formControlName="description"
              rows="3"
              class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 placeholder-transparent bg-gray-50/50 hover:bg-white focus:bg-white resize-none"
              [class.border-red-400]="recipeForm.get('description')?.invalid && recipeForm.get('description')?.touched"
              placeholder="Description"
              id="description"
            ></textarea>
            <label for="description" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 transition-all peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-400 peer-placeholder-shown:top-4 peer-focus:-top-2.5 peer-focus:text-sm peer-focus:text-orange-600">
              Description
            </label>
            <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-orange-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
            @if (getFieldError('description')) {
            <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
              {{ getFieldError('description') }}
            </p>
            }
          </div>

          <!-- Enhanced grid layout with better spacing and styling -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="group relative">
              <select
                formControlName="cuisine"
                class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 bg-gray-50/50 hover:bg-white focus:bg-white appearance-none cursor-pointer"
                [class.border-red-400]="recipeForm.get('cuisine')?.invalid && recipeForm.get('cuisine')?.touched"
                id="cuisine"
              >
                <option value="">Select cuisine</option>
                <option value="Italian">ğŸ‡®ğŸ‡¹ Italian</option>
                <option value="Chinese">ğŸ‡¨ğŸ‡³ Chinese</option>
                <option value="Mexican">ğŸ‡²ğŸ‡½ Mexican</option>
                <option value="Indian">ğŸ‡®ğŸ‡³ Indian</option>
                <option value="French">ğŸ‡«ğŸ‡· French</option>
                <option value="American">ğŸ‡ºğŸ‡¸ American</option>
                <option value="Japanese">ğŸ‡¯ğŸ‡µ Japanese</option>
                <option value="Mediterranean">ğŸŒŠ Mediterranean</option>
              </select>
              <label for="cuisine" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 peer-focus:text-orange-600">
                Cuisine
              </label>
              <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
                <svg class="w-5 h-5 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              @if (getFieldError('cuisine')) {
              <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
                {{ getFieldError('cuisine') }}
              </p>
              }
            </div>

            <div class="group relative">
              <select
                formControlName="mealType"
                class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 bg-gray-50/50 hover:bg-white focus:bg-white appearance-none cursor-pointer"
                [class.border-red-400]="recipeForm.get('mealType')?.invalid && recipeForm.get('mealType')?.touched"
                id="mealType"
              >
                <option value="">Select meal type</option>
                <option value="Breakfast">ğŸŒ… Breakfast</option>
                <option value="Lunch">ğŸŒ Lunch</option>
                <option value="Dinner">ğŸŒ™ Dinner</option>
                <option value="Dessert">ğŸ° Dessert</option>
                <option value="Snack">ğŸ¿ Snack</option>
                <option value="Appetizer">ğŸ¥— Appetizer</option>
              </select>
              <label for="mealType" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 peer-focus:text-orange-600">
                Meal Type
              </label>
              <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
                <svg class="w-5 h-5 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              @if (getFieldError('mealType')) {
              <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
                {{ getFieldError('mealType') }}
              </p>
              }
            </div>
          </div>

          <!-- Enhanced time and difficulty inputs -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="group relative">
              <input
                formControlName="preparationTime"
                type="number"
                min="1"
                class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 placeholder-transparent bg-gray-50/50 hover:bg-white focus:bg-white"
                [class.border-red-400]="recipeForm.get('preparationTime')?.invalid && recipeForm.get('preparationTime')?.touched"
                placeholder="Preparation Time"
                id="preparationTime"
              />
              <label for="preparationTime" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 peer-focus:text-orange-600">
                â±ï¸ Preparation Time (minutes)
              </label>
              @if (getFieldError('preparationTime')) {
              <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
                {{ getFieldError('preparationTime') }}
              </p>
              }
            </div>

            <div class="group relative">
              <select
                formControlName="difficulty"
                class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 bg-gray-50/50 hover:bg-white focus:bg-white appearance-none cursor-pointer"
                [class.border-red-400]="recipeForm.get('difficulty')?.invalid && recipeForm.get('difficulty')?.touched"
                id="difficulty"
              >
                <option value="Easy">ğŸŸ¢ Easy</option>
                <option value="Medium">ğŸŸ¡ Medium</option>
                <option value="Hard">ğŸ”´ Hard</option>
              </select>
              <label for="difficulty" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 peer-focus:text-orange-600">
                Difficulty Level
              </label>
              <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none">
                <svg class="w-5 h-5 text-gray-400 group-hover:text-orange-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
              @if (getFieldError('difficulty')) {
              <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
                {{ getFieldError('difficulty') }}
              </p>
              }
            </div>
          </div>

          <!-- Enhanced ingredients textarea -->
          <div class="group relative">
            <textarea
              formControlName="ingredients"
              rows="4"
              class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 placeholder-transparent bg-gray-50/50 hover:bg-white focus:bg-white resize-none"
              [class.border-red-400]="recipeForm.get('ingredients')?.invalid && recipeForm.get('ingredients')?.touched"
              placeholder="Ingredients"
              id="ingredients"
            ></textarea>
            <label for="ingredients" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 peer-focus:text-orange-600">
              ğŸ¥• Ingredients (one per line)
            </label>
            <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-orange-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
            @if (getFieldError('ingredients')) {
            <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
              {{ getFieldError('ingredients') }}
            </p>
            }
          </div>

          <!-- Enhanced instructions textarea -->
          <div class="group relative">
            <textarea
              formControlName="instructions"
              rows="6"
              class="peer w-full px-4 py-4 rounded-xl border-2 border-gray-200 focus:border-orange-500 focus:ring-4 focus:ring-orange-100 transition-all duration-300 placeholder-transparent bg-gray-50/50 hover:bg-white focus:bg-white resize-none"
              [class.border-red-400]="recipeForm.get('instructions')?.invalid && recipeForm.get('instructions')?.touched"
              placeholder="Instructions"
              id="instructions"
            ></textarea>
            <label for="instructions" class="absolute left-4 -top-2.5 bg-white px-2 text-sm font-medium text-gray-600 peer-focus:text-orange-600">
              ğŸ“ Step-by-step Instructions
            </label>
            <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-orange-500/10 to-pink-500/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none"></div>
            @if (getFieldError('instructions')) {
            <p class="text-red-500 text-sm mt-2 animate-in slide-in-from-left duration-200">
              {{ getFieldError('instructions') }}
            </p>
            }
          </div>

          <!-- Enhanced image upload with drag and drop styling -->
          <div class="group relative">
            <div class="relative border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-orange-400 transition-all duration-300 bg-gray-50/50 hover:bg-orange-50/50">
              <input
                type="file"
                accept="image/*"
                (change)="onImageChange($event)"
                class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
              />
              <div class="space-y-3">
                <div class="mx-auto w-16 h-16 bg-gradient-to-br from-orange-400 to-pink-500 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                </div>
                <div>
                  <p class="text-lg font-medium text-gray-700 group-hover:text-orange-600 transition-colors">
                    ğŸ“¸ Upload Recipe Image
                  </p>
                  <p class="text-sm text-gray-500 mt-1">
                    Drag and drop or click to select
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Enhanced action buttons with better animations -->
          <div class="flex justify-end space-x-4 pt-8 border-t border-gray-100">
            <button
              type="button"
              (click)="onClose()"
              class="group relative px-8 py-4 text-sm font-medium text-gray-700 bg-gray-100 rounded-full border border-transparent shadow-sm hover:bg-gray-200 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-200 transition-all duration-200 overflow-hidden"
            >
              <span class="relative z-10">Cancel</span>
              <div class="absolute inset-0 bg-gradient-to-r from-gray-200 to-gray-300 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></div>
            </button>
            <button
              type="submit"
              [disabled]="recipeForm.invalid || loading"
              class="group relative px-8 py-4 text-sm font-medium text-white bg-gradient-to-r from-orange-500 to-pink-500 rounded-full border border-transparent shadow-lg hover:shadow-xl hover:scale-105 focus:outline-none focus:ring-4 focus:ring-orange-200 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 overflow-hidden"
            >
              @if (loading) {
              <span class="flex items-center relative z-10">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Creating Magic...
              </span>
              } @else { 
              <span class="relative z-10">âœ¨ Create Recipe</span>
              }
              <div class="absolute inset-0 bg-gradient-to-r from-orange-600 to-pink-600 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></div>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
}

<!-- Added custom scrollbar styles -->
<style>
.custom-scrollbar::-webkit-scrollbar {
  width: 6px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: #f1f5f9;
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #f97316, #ec4899);
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(to bottom, #ea580c, #db2777);
}
</style>
